<ion-view name="cadastrarTeste">
    <div class="bar bar-header bar-positive">
        <h1 class="title">{{title}}</h1>
    </div>
    <ion-content class="padding has-header iris-background">
        <div class="container">
            <form name="testForm" novalidate>
                <div class="item item-divider">Descrição:</div>
                <label class="item item-input" ng-class="{ 'has-error' : testForm.descricaoTeste.$invalid }">
                    <textarea name="descricaoTeste" msd-elastic ng-readonly="isEditing" ng-model="teste.nome" ng-minlength="5" placeholder="Digite a descrição do teste..." required></textarea>
                </label>
                <div class="form-errors" ng-messages="testForm.descricaoTeste.$error" ng-messages-include="templates/form-errors.html" ng-show="testForm.descricaoTeste.$touched">
                    <div class="form-error" ng-message="required">Descrição obrigatória.</div>
                </div>
                <div class="card">
                    <div class="item item-divider">Questões:</div>
                    <ion-list>
                        <ion-item class="item-remove-animate  item-text-wrap item-icon-right" ng-repeat="pergunta in teste.perguntas" type="item-text-wrap" ng-click="perguntaClicked(pergunta)">
                            <p>{{pergunta.nome}}</p>
                            <i class="icon ion-chevron-left icon-accessory"></i>
                            <ion-option-button class="button-assertive" ng-click="removerQuestao(pergunta, (($index)))">Remover</ion-option-button>
                        </ion-item>
                    </ion-list>
                    <button class="button icon icon-right ion-android-add" ng-hide="isEditing" ng-click="addPergunta()" style="width: 100%;">
                        Adicionar questão
                    </button>
                </div>
                <button class="button button-block iris-button" ng-hide="isEditing" ng-click="salvar()" type="submit" ng-disabled="isSaveTestDisabled(testForm.descricaoTeste.$valid)">Salvar teste</button>
                <button class="button button-block iris-button" ng-click="cancelar()">Cancelar</button>
            </form>

            <script id="add-pergunta-teste.html" type="text/ng-template">
                <ion-modal-view view title="Criar pergunta">
                    <div class="bar bar-header bar-positive">
                        <h1 class="title">{{questionTitle}}</h1>
                    </div>
                    <ion-content class="padding has-header iris-background">
                        <div class="container">
                            <form name="questionForm" novalidate>
                                <div class="item item-divider">Questão:</div>
                                <label class="item item-input" ng-class="{ 'has-error' : questionForm.descricaoQuestao.$invalid }">
                                    <textarea name="descricaoQuestao" msd-elastic ng-readonly="isEditing" ng-model="perguntaSelecionada.nome" ng-minlength="5" placeholder="Digite a descrição da questão..." style="min-height: 20px" required></textarea>
                                </label>
                                <div class="form-errors" ng-messages="questionForm.descricaoQuestao.$error" ng-messages-include="templates/form-errors.html" ng-show="questionForm.descricaoQuestao.$touched">
                                    <div class="form-error" ng-message="maxlength"></div>
                                </div>
                                <div style="margin-top: 20px; width: 100%; max-height: 400px; text-align: center">
                                    <img ng-src="data:image/jpg;base64,{{perguntaSelecionada.imagem}}" ng-show="perguntaSelecionada.imagem" style="width: 100%;"/>
                                </div>
                                <button class="button button-block" ng-click="addImage()" ng-hide="isEditing">
                                    <span ng-show="perguntaSelecionada.imagem">Alterar imagem</span>
                                    <span ng-show="!perguntaSelecionada.imagem">Adicionar imagem</span>
                                </button>
                                <div class="item item-divider" style="margin-top: 20px;">Alternativas: </div>
                                <ion-list>
                                    <ion-radio class="item item-text-wrap item-icon-right item-radio" ng-disabled="isEditing" ng-repeat="alternativa in perguntaSelecionada.alternativas" ng-value="(( $index ))" ng-model="alternativaSelecionada.index" name="nome">{{alternativa.nome}}
                                    </ion-radio>
                                </ion-list>
                                <label class="item item-input" ng-hide="perguntaSelecionada.alternativas.length >= 5 || isEditing">
                                    <textarea msd-elastic placeholder="Digite a descrição da alternativa..." ng-model="novaAlternativa.nome" style="min-height: 40px"></textarea>
                                </label>
                                <button class="button icon icon-right ion-android-add" ng-hide="perguntaSelecionada.alternativas.length >= 5 || isEditing" ng-click="addAlternativa()" style="width: 100%;">
                                    Adicionar alternativa
                                </button>
                                <button class="button icon icon-right ion-android-remove" ng-show="alternativaSelecionada.index != null && !isEditing" ng-click="removeAlternativa(alternativaSelecionada.index)" style="width: 100%;">
                                    Remover alternativa selecionada
                                </button>
                                <small ng-hide="isEditing">*Mínimo de 2 e máximo de 5 alternativas</small>
                                <button class="button button-block iris-button" style="margin-top: 20px" ng-hide="isEditing" type="submit" ng-click="okPergunta(perguntaSelecionada)" ng-disabled="isAddQuestionDisabled(questionForm.descricaoQuestao.$valid, perguntaSelecionada)">
                                    Adicionar questão
                                </button>
                                <button class="button button-block iris-button" ng-click="cancelarPergunta(perguntaSelecionada)">
                                    Cancelar
                                </button>
                            </form>
                        </div>
                    </ion-content>
                </ion-modal-view>
            </script>
            <script id="templates/form-errors.html" type="text/ng-template">
                <div class="form-error" ng-message="required">Descrição obrigatória.</div>
                <div class="form-error" ng-message="minlength">Descrição deve ter no mínimo 5 caracteres.</div>
            </script>
        </div>
    </ion-content>
</ion-view>